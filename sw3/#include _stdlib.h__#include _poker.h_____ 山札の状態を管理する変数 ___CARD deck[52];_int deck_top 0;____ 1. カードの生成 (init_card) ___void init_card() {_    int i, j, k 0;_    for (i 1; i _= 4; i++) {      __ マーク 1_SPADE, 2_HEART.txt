#include <stdlib.h>
#include "poker.h"

/* 山札の状態を管理する変数 */
CARD deck[52];
int deck_top = 0;

/* 1. カードの生成 (init_card) */
void init_card() {
    int i, j, k = 0;
    for (i = 1; i <= 4; i++) {      /* マーク 1:SPADE, 2:HEART, 3:DIAMOND, 4:CLUB */
        for (j = 1; j <= 13; j++) { /* 数字 1(A)〜13(K) */
            deck[k].mark = i;
            deck[k].number = j;
            k++;
        }
    }
}

/* 2. カードのシャッフル (shuffle_card) */
void shuffle_card() {
    int i, r;
    CARD tmp;
    /* Fisher-Yatesのアルゴリズム */
    for (i = 51; i > 0; i--) {
        r = rand() % (i + 1); /* 0〜iの乱数 */
        /* 入れ替え */
        tmp = deck[i];
        deck[i] = deck[r];
        deck[r] = tmp;
    }
    deck_top = 0; /* 山札の先頭をリセット */
}

/* 3. カードを引く (山札から補充) */
void fill_card(int player_id, int hand_index) {
    if (deck_top < 52) {
        hand[player_id][hand_index] = deck[deck_top];
        deck_top++;
    }
}

/* 4. ゲーム全体の初期化 (init_game) */
void init_game() {
    int i, p;
    
    init_card();    /* カードを52枚作成 */
    shuffle_card(); /* 混ぜる */

    /* 最初に各プレイヤーへ5枚ずつ配る */
    for (p = 0; p < 2; p++) {
        for (i = 0; i < HAND_SIZE; i++) {
            fill_card(p, i);
        }
        phase[p] = 0; /* 交換中状態にセット */
    }
    
    is_finish = 0;
    winner = 2; /* 引き分け/未決状態 */
}
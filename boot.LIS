                         4 .list
                         5 /* „É¨„Ç∏„Çπ„ÇøÂÆöÁæ© */
                         6 .equ REGBASE, 0xfff000 | DMAP „Çí‰ΩøÁî®Ôºé
                         7 .equ IOBASE, 0x00d00000
                         8 
                         9 /* Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø*/
                        10 .equ IVR, REGBASE+0x300 | Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        11 .equ IMR, REGBASE+0x304 | Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        12 .equ ISR, REGBASE+0x30c | Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        13 .equ IPR, REGBASE+0x310 | Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        14 
                        15 /* „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø */
                        16 .equ TCTL1, REGBASE+0x600  | „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        17 .equ TPRER1, REGBASE+0x602 | „Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        18 .equ TCMP1, REGBASE+0x604  | „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        19 .equ TCN1, REGBASE+0x608   | „Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        20 .equ TSTAT1, REGBASE+0x60a | „Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        21 
                        22 /* UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø */
                        23 .equ USTCNT1, REGBASE+0x900 | UART1 „Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        24 .equ UBAUD1, REGBASE+0x902  | UART1 „Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        25 .equ URX1, REGBASE+0x904    | UART1 Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        26 .equ UTX1, REGBASE+0x906    | UART1 ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        27 
                        28 /* LED */
                        29 .equ LED7, IOBASE+0x000002f | „Éú„Éº„ÉâÊê≠Ëºâ„ÅÆ LED Áî®„É¨„Ç∏„Çπ„Çø
                        30 .equ LED6, IOBASE+0x000002d | ‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤ A.4.3.1
                        31 .equ LED5, IOBASE+0x000002b
                        32 .equ LED4, IOBASE+0x0000029
                        33 .equ LED3, IOBASE+0x000003f
                        34 .equ LED2, IOBASE+0x000003d
                        35 .equ LED1, IOBASE+0x000003b
                        36 .equ LED0, IOBASE+0x0000039
                        37 
                        38 	/* „Çπ„Çø„ÉÉ„ÇØ */
                        39 .section .bss
                        40 .even
001894 0000 0000        41 SYS_STK:	.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        41 
       0000 0000        41 
       0000 0000        41 
       0000 0000        41 
                        42 .even
                        43 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        44 
                        45 /* ÂàùÊúüÂåñ */
                        46 .section .text
                        47 .even
                        48 boot:
                        49 	* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        50 	move.w #0x2700,%SR
000404 4FF9 0000        51 	lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             51 
                        52 ****************
                        53 **Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        54 	****************
00040a 13FC 0040        55 	move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        55 
000412 23FC 00FF        56 	move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        56 
       F304             56 
                        57 
                        58 ****************
                        59 ** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        60 	****************
00041c 33FC 0000        61 	move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        61 
000424 33FC E100        62 	move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶ÅÊ
       00FF F900        62 
00042c 33FC 0038        63 	move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        63 
                        64 
                        65 ****************
                        66 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        67 *****************
000434 33FC 0004        68 	move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®„
       00FF F600        68 
                        69 
                        70 ***************************************************************
                        71 ** STEP2„ÅÆÂá¶ÁêÜ
                        72 ***************************************************************
                        73 		/* ÂàùÊúüÂåñÂá¶ÁêÜ„Çí„É°„Ç§„É≥„É´„Éº„ÉÅ„É≥„Åã„Çâ„Åì„Å°„Çâ„Å∏ÁßªÂãï */
                        74 		*lea.l uart1_interrupt, %a0
                        75 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 21FC 0000        76 	move.l #uart1_interrupt, 0x110
       0000 0110        76 
000444 33FC E100        77 	move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ
       00FF F900        77 
00044c 23FC 00FF        78 	move.l #0x00ff3ffb,IMR  |UART1Ë®±ÂèØ
       3FFB 00FF        78 
       F304             78 
000456 46FC 2700        79 	move.w #0x2700, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´7 */
00045a 6000 04CC        80 	bra MAIN	
                        81 
                        82 /* Ââ≤„ÇäËæº„Åø„Éè„É≥„Éâ„É© */
                        83 
                        84 
                        85 	
                        86 /*uart1_interrupt:
                        87     movem.l %D0-%D7/%A0-%A6, -(%SP) | ‰ΩøÁî®„Åô„Çã„É¨„Ç∏„Çπ„Çø„Çí„Çπ„Çø„ÉÉ„ÇØ„Å´‰øùÂ≠ò
                        88     move.w UTX1, %D0                | UTX1„ÇíD0„É¨„Ç∏„Çπ„Çø„Å´„Ç≥„Éî„Éº„Åó‰øùÂ≠ò„Åó„Å¶„Åä„Åè
                        89     move.w %D0, %D1                 | Ë®àÁÆóÁî®„Å´D1„É¨„Ç∏„Çπ„Çø„Å´„Ç≥„Éî„Éº
                        90     lsr.w #8, %D1
                        91     lsr.w #7, %D1                   | 15ÂõûÂè≥„Ç∑„Éï„ÉàÔºà‰∏ä‰Ωç„Éì„ÉÉ„Éà„ÅØ0Âüã„ÇÅÔºâ
                        92     cmpi.w #1, %D1                  | 0=FIFO„ÅåÁ©∫„Åß„ÅØ„Å™„ÅÑ, 1=Á©∫„Åß„ÅÇ„ÇãÔºàÂâ≤„ÇäËæº„ÅøÁô∫Áîü
                        93     bne UART1_INTR_SKIP_PUT         | ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„Åß„Å™„ÅÑ„Å™„Çâ„Çπ„Ç≠„ÉÉ„Éó
                        94     move.l #0, %D1                  | ch=%D1.L=0
                        95     jsr INTERPUT
                        96 	*/
                        97 .section .text
                        98 .even
                        99 uart1_interrupt:
00045e 13FC 0033       100 	move.b #'3', LED5
       00D0 002B       100 
000466 48E7 8000       101 	movem.l %d0, -(%sp)
                       102 	*move.b #'a', %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
                       103 	*addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó */
                       104 	*move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ */
00046a 3039 00FF       105 	move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            105 
000470 123C 0000       106 	move.b #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
000474 0C40 8000       107 	cmp #0x8000,%d0
000478 6500 0006       108 	bcs uart1_END
00047c 4EBA 0132       109 	jsr INTERPUT
                       110 uart1_END:	
000480 4CDF 0001       111 	movem.l (%sp)+, %d0
000484 4E73            112 	rte
                       113 UART1_INTR_SKIP_PUT:
000486 3639 00FF       114     move.w URX1, %D3                | Âèó‰ø°„É¨„Ç∏„Çπ„Çø URX1 „Çí %D3.W „Å´„Ç≥„Éî„Éº
       F904            114 
00048c 1403            115     move.b %D3, %D2                 | %D3.W „ÅÆ‰∏ã‰Ωç 8bit(„Éá„Éº„ÇøÈÉ®ÂàÜ) „Çí %D2.B „Å´„Ç≥„Éî„Éº
00048e E04B            116     lsr.w #8, %D3
000490 EA4B            117     lsr.w #5, %D3                   | 13ÂõûÂè≥„Ç∑„Éï„ÉàÔºà‰∏ä‰Ωç„Éì„ÉÉ„Éà„ÅØ0Âüã„ÇÅÔºâ
000492 0243 0001       118     and.w #0x1, %D3                 | 0bitÁõÆ‰ª•Â§ñ„Çí0„Å´
000496 0C43 0001       119     cmpi.w #1, %D3                  | 0 = Âèó‰ø° FIFO „Å´„Éá„Éº„Çø„Åå„Å™„ÅÑÔºé1 = „Éá„Éº„Çø„Åå„ÅÇ„Ç
00049a 6600 0008       120     bne UART1_INTR_SKIP_GET
00049e 4281            121     clr.l %D1                       | ch = %D1.L = 0, (data = %D2.B„ÅØ‰ª£ÂÖ•Ê∏à)
0004a0 4EBA 0408       122     jsr INTERGET
                       123 UART1_INTR_SKIP_GET:
0004a4 4CDF 7FFF       124     movem.l (%SP)+, %D0-%D7/%A0-%A6 | „É¨„Ç∏„Çπ„Çø„ÇíÂæ©Â∏∞
0004a8 4E73            125     rte
                       126 
                       127 tmr1_interrupt:
0004aa 48E7 FFFE       128     movem.l %D0-%D7/%A0-%A6,-(%SP)  | ‰ΩøÁî®„Åô„Çã„É¨„Ç∏„Çπ„Çø„Çí„Çπ„Çø„ÉÉ„ÇØ„Å´‰øùÂ≠ò
0004ae 3039 00FF       129     move.w TSTAT1, %D0              | %D0=TSTAT1
       F60A            129 
0004b4 0240 0001       130     and.w #0x1, %D0                 | 0bitÁõÆ‰ª•Â§ñ„Çí0„Å´
0004b8 0C40 0000       131     cmp.w #0, %D0
0004bc 6700 000C       132     beq TMR1_END                    | TSTAT1 „ÅÆÁ¨¨ 0 „Éì„ÉÉ„Éà„Åå 1 „Å®„Å™„Å£„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã
0004c0 4279 00FF       133     clr.w TSTAT1                    | TSTAT1 „Çí 0 „ÇØ„É™„Ç¢
       F60A            133 
0004c6 4EBA 0456       134     jsr CALL_RP
                       135 TMR1_END:
0004ca 4CDF 7FFF       136 	movem.l (%SP)+, %D0-%D7/%A0-%A6 | „É¨„Ç∏„Çπ„Çø„ÇíÂæ©Â∏∞
0004ce 4E73            137 	rte
                       138 .include "syscall.s"
                        -4 .equ SYSCALL_NUM_GETSTRING,   1
                        -3 .equ SYSCALL_NUM_PUTSTRING,   2
                        -2 .equ SYSCALL_NUM_RESET_TIMER, 3
                        -1 .equ SYSCALL_NUM_SET_TIMER,   4
                         0 
                         1 /*
                         2  * syscall_handler
                         3  * %d0: syscall number
                         4  * %dx: syscall argument
                         5  */
                         6 syscall_handler:
0004d0 48E7 7FFE         7     movem.l %D1-%D7/%A0-%A6, -(%SP)
                         8 
0004d4 0C80 0000         9 	cmpi.l #SYSCALL_NUM_GETSTRING, %D0
       0001              9 
0004da 6700 0026        10 	beq CALL_GETSTRING
                        11 
0004de 0C80 0000        12 	cmpi.l #SYSCALL_NUM_PUTSTRING, %D0
       0002             12 
0004e4 6700 0024        13 	beq CALL_PUTSTRING
                        14     
0004e8 0C80 0000        15     cmpi.l #SYSCALL_NUM_RESET_TIMER, %D0
       0003             15 
0004ee 6700 0022        16     beq CALL_RESET_TIMER
                        17     
                        18 
0004f2 0C80 0000        19 	cmpi.l #SYSCALL_NUM_SET_TIMER, %D0
       0004             19 
0004f8 6700 0020        20 	beq CALL_SET_TIMER
                        21     
                        22     
                        23 END_SYSCALL_HNDR:
0004fc 4CDF 7FFE        24     movem.l (%SP)+, %D1-%D7/%A0-%A6
000500 4E73             25 	rte
                        26 
                        27 CALL_GETSTRING:
000502 4EBA 03BA        28 	jsr GETSTRING
000506 6000 FFF4        29 	 bra END_SYSCALL_HNDR
                        30 
                        31 CALL_PUTSTRING:
00050a 4EBA 00E2        32 	jsr PUTSTRING
00050e 6000 FFEC        33 	bra END_SYSCALL_HNDR
                        34 	
                        35 CALL_RESET_TIMER:
000512 4EBA 03E2        36 	jsr RESET_TIMER
000516 6000 FFE4        37 	bra END_SYSCALL_HNDR
                        38 CALL_SET_TIMER:
00051a 4EBA 03E4        39 	jsr SET_TIMER
00051e 6000 FFDC        40 	bra END_SYSCALL_HNDR
                       139 .include "queue.s"
                        -4 .section .data
                        -3 .even	
                        -2 .equ IN_COUNT, 257
                        -1 .equ OUT_COUNT, 257
                         0 .equ queue_number, 1
                         1 .equ OFFSET_1, 0x100
                         2 .equ END_0, 0xff
                         3 .equ END_1, 0x1ff
00098c 0000 0000         4 top: .ds.b 0x200
       0000 0000         4 
       0000 0000         4 
       0000 0000         4 
       0000 0000         4 
000b8c 0000 0000         5 bottom: .ds.l 1
000b90 0000 0000         6 in: .ds.l 1
000b94 0000 0000         7 in_0: .ds.l 1
000b98 0000 0000         8 in_1: .ds.l 1
000b9c 0000 0000         9 out: .ds.l 1
000ba0 0000 0000        10 out_0: .ds.l 1
000ba4 0000 0000        11 out_1: .ds.l 1
000ba8 0000 0000        12 s: .ds.l 1
000bac 0000 0000        13 s0: .ds.l 1
000bb0 0000 0000        14 s1: .ds.l 1
000bb4 0000 0000        15 START_LABEL: .ds.l 1
                        16 
                        17 
                        18 *****************„Ç≠„É•„Éº„ÅÆÂàùÊúüÂåñÂá¶ÁêÜ*******************************************************
                        19 /*Init_Q:
                        20 	movem.l %d0-%d4/%a0-%a3,-(%sp)
                        21 	moveq 	#0, %d0
                        22 	lea.l	Q_INFO, %a1		/* a1: Q_INFO„ÅÆÈñãÂßãÂú∞ÁÇπ 
                        23 	lea.l	Q0_START, %a2 		/* a2: Q0„ÅÆÂÖàÈ†≠Áï™Âú∞ 
                        24 	move.w	#B_SIZE, %d2		/* d2: 256 
                        25 	move.w	#Q_INFO_SIZE, %d3	/* d3: 20 („Ç≠„É•„ÉºÔºëÂÄãÂàÜ„ÅÆÊÉÖÂ†±Èáè) */
                        26 .section .text
                        27 .even	
                        28 Init_Q:
000522 48E7 003E        29 	movem.l %a2-%a6, -(%sp) /* ÂøúÊÄ•Âá¶ÁΩÆ*/
000526 45F9 0000        30 	lea.l top, %a2
       0000             30 
00052c 23CA 0000        31 	move.l %a2, in_0
       0000             31 
000532 23CA 0000        32 	move.l %a2, out_0
       0000             32 
000538 47EA 0100        33 	lea.l OFFSET_1(%a2), %a3
00053c 23CB 0000        34 	move.l %a3, in_1
       0000             34 
000542 23CB 0000        35 	move.l %a3, out_1
       0000             35 
000548 49F9 0000        36 	lea.l s, %a4
       0000             36 
00054e 4BF9 0000        37 	lea.l s0, %a5
       0000             37 
000554 4DF9 0000        38 	lea.l s1, %a6
       0000             38 
00055a 28BC 0000        39 	move.l #0,(%a4)
       0000             39 
000560 2ABC 0000        40 	move.l #0,(%a5)
       0000             40 
000566 2CBC 0000        41 	move.l #0,(%a6)
       0000             41 
00056c 4CDF 7C00        42 	movem.l (%sp)+, %a2-%a6 /* ÂøúÊÄ•Âá¶ÁΩÆ*/
000570 4E75             43 	rts
                        44 
                        45 
                        46 LOOP_Init:				/* d4: Ë®àÁÆóÁî® */
000572 2800             47 	move.l	%d0,	%d4
000574 C8C3             48 	mulu	%d3,	%d4		/* d4 = d0 * Q_INFO_SIZE */
000576 2044             49 	move.l	%d4,	%a0
000578 D1C9             50 	add.l	%a1,	%a0		/* a0 = Q_INFO + d0 * Q_INFO_SIZE(ÂêÑ„Ç≠„É•„ÉºÊÉÖÂ†±„ÅÆÂÖàÈ†≠) */
                        51 	
00057a 2800             52 	move.l	%d0,	%d4			
00057c C8C2             53 	mulu	%d2,	%d4		/* d4 = d0 * B_SIZE */
00057e 2644             54 	move.l	%d4,	%a3
000580 D7CA             55 	add.l	%a2,	%a3		/* a3 = Q0_START + d0 * B_SIZE(ÂêÑ„Ç≠„É•„Éº„ÅÆÂÖàÈ†≠) */
                        56 
000582 214B 0000        57 	move.l	%a3,	TOP_OFS(%a0)	
000586 214B 0004        58 	move.l	%a3,	OUT_OFS(%a0)
00058a 214B 0008        59 	move.l	%a3,	IN_OFS(%a0)
                        60 	
00058e D7FC 0000        61 	adda.l	#B_SIZE_MINUS,	%a3
       00FF             61 
000594 214B 000C        62 	move.l	%a3,	BOTTOM_OFS(%a0)
000598 217C 0000        63 	move.l	#0,	S_OFS(%a0)
       0000 0010        63 
                        64 
0005a0 5240             65 	addq	#1,	%d0
0005a2 0C40 0002        66 	cmp	#2,	%d0
0005a6 6600 FFCA        67 	bne	LOOP_Init		/* „Ç≠„É•„Éº2„Å§ÂàÜÁπ∞Ëøî„Åó */
                        68 	
                        69 end_Init:	
0005aa 4CDF 0F1F        70 	movem.l (%sp)+, %d0-%d4/%a0-%a3
0005ae 4E75             71 	rts
                        72 
                        73 
                        74 ******INTERPUT*************************************************************************************
                        75 	** ÂÖ•ÂäõÔºöd1.lÔºà„ÉÅ„É£„É≥„Éç„É´Ôºâ
                        76 /*
                        77 INTERPUT:
                        78 	movem.l %d0-%d2,-(%sp)
                        79 	move.w  #0x2700, %sr
                        80 	cmpi #0, %d1
                        81 	bne	End_INTERPUT
                        82 	moveq	#1, %d0
                        83 	jsr	OUTQ
                        84 	*Âá∫ÂäõÔºëÔºöd0(Â§±Êïó 0/ ÊàêÂäü 1 )
                        85 	*Âá∫ÂäõÔºíÔºöd1ÔºàÂèñ„ÇäÂá∫„Åó„Åü8bit„Éá„Éº„ÇøÔºâ
                        86 	cmpi #0, %d0
                        87 	beq	INTERPUT_MASK
                        88 	ori #0x0800, %D1                | „Éò„ÉÉ„ÉÄ„Çí‰ª£ÂÖ•
                        89 	move.w %D1, UTX1                | ÈÄÅ‰ø°
                        90 	bra	End_INTERPUT
                        91 INTERPUT_MASK:
                        92 	move.w	USTCNT1, %d2
                        93 	andi.w	#0xFFFB, %d2	
                        94 	move.w	%d2,	USTCNT1 
                        95 	bra End_INTERPUT
                        96 End_INTERPUT:
                        97 	movem.l (%sp)+, %d0-%d2
                        98 	rts*/
                        99 INTERPUT:
0005b0 48E7 E000       100 	movem.l %d0-%d2, -(%sp)
0005b4 46FC 2700       101 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
0005b8 0C01 0000       102 	cmp.b #0x0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
0005bc 6600 001E       103 	bne INTERPUT_END
0005c0 103C 0001       104 	move.b #1, %d0
0005c4 4EBA 0224       105 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
0005c8 0C40 0000       106 	cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
0005cc 6700 0014       107 	beq INTERPUT_MASK
0005d0 1401            108 	move.b %d1, %d2
0005d2 0642 0800       109 	addi.w #0x0800, %d2
0005d6 33C2 00FF       110 	move.w %d2, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            110 
                       111 
                       112 INTERPUT_END:
0005dc 4CDF 0007       113 	movem.l (%sp)+, %d0-%d2
0005e0 4E75            114 	rts
                       115 
                       116 INTERPUT_MASK:
0005e2 33FC E100       117 	move.w #0xe100, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       117 
                       118 		/* ‚Üë ‰ΩïÊïÖ„Åã„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà„Åï„Çå„Å¶„ÅÑ„Åü„ÅÆ„Åß„ÄÅ‰øÆÊ≠£ */
                       119 
0005ea 6000 FFF0       120 	bra INTERPUT_END
                       121 	
                       122 ***************************************************************************************************
                       123 
                       124 *********PUTSTRING*********************************************************************************
                       125 ** ÂÖ•ÂäõÔºëÔºö „ÉÅ„É£„Éç„É´ ch ‚Üí %D1.L
                       126 ** ÂÖ•ÂäõÔºíÔºö„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ p ‚Üí %D2.L
                       127 ** ÂÖ•ÂäõÔºìÔºöÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞ size ‚Üí %D3.L
                       128 ** Âá∫Âäõ  ÔºöÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞ sz ‚Üí %D0.L
                       129 	
                       130 /*PUTSTRING:
                       131 	movem.l %d1-%d6/%a0,-(%sp)
                       132 	cmpi #0, %d1
                       133 	bne	End_PUTSTRING
                       134 	moveq	#0, %d4  /* d4 = sz = 0 
                       135 	movea.l	%d2, %a0 /* a0 = i = p 
                       136 	cmpi #0, %d3
                       137 	beq	PUTSTRING_10
                       138 LOOP_PUTSTRING:	
                       139 	cmp	%d3, %d4
                       140 	beq	PUTSTRING_9
                       141 	moveq	#1, %d0
                       142 	move.b	(%a0), %d1
                       143 	jsr	INQ
                       144 	*d0 :„Ç≠„É•„ÉºÁï™Âè∑
                       145 	*d1 :8bit„Éá„Éº„Çø
                       146 	*Âá∫ÂäõÔºöd0(Â§±Êïó 0/ ÊàêÂäü 1 )
                       147 	cmpi #0, %d0
                       148 	beq	PUTSTRING_9
                       149 	addq	#1, %d4
                       150 	addq	#1, %a0
                       151 	bra LOOP_PUTSTRING	
                       152 PUTSTRING_9:
                       153 	move.w	USTCNT1, %d6
                       154 	ori.w	#0x0004, %d6
                       155 	move.w	%d6,	USTCNT1 
                       156 PUTSTRING_10:
                       157 	move.l	%d4, %d0
                       158 End_PUTSTRING:
                       159 	movem.l (%sp)+, %d1-%d6/%a0
                       160 	rts*/
                       161 PUTSTRING:
0005ee 48E7 0FFE       162 		movem.l %a0-%a6/%d4-%d7, -(%SP)
                       163 
0005f2 0C01 0000       164 		cmp.b #0x00, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
0005f6 6600 0042       165 		bne PUTSTRING_END
                       166 		/* rv: „Éê„Ç§„Éà„Çµ„Ç§„Ç∫„ÅÆÊØîËºÉ„ÄÇÔºê„Åß„ÅØ„Å™„ÅÑ„Å®„Åç„Å´ÁµÇ‰∫Ü„Åô„Çã*/
                       167 
0005fa 7800            168 		move.l #0x0000,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       169 		/* rv: „Éá„Éº„ÇøÊï∞(sz)„ÅÆÂàùÊúüÂåñ*/
                       170 
0005fc 2242            171 		move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ/
                       172 		/* rv: Ë™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Çía1„Å´Ê†ºÁ¥ç„Åô„Çã*/	
                       173 
0005fe 0C83 0000       174 		cmp.l #0x0000,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            174 
000604 6700 0034       175 		beq PUTSTRING_END
                       176 		/* rv: d3(size)„Åå0„Å™„Çâ„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
                       177 
                       178 
                       179 LOOP_STEP5:
000608 B684            180 		cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
00060a 6700 001A       181 		beq PUTSTRING_MASK
                       182 		/* d3 „Å® d4 size = sz „Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï*/
                       183 
00060e 103C 0001       184 		move.b #0x01,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       185 		/* rv:  INQ„Åå„Éê„Ç§„Éà„Çµ„Ç§„Ç∫„ÅßÊØîËºÉ„Åô„Çã„ÅÆ„ÅßÔΩÇ„Å´Ë®≠ÂÆö*/
000612 1219            186 		move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       187 		/* rv: ÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Åã„ÇâÈ†Ü„Å´Ê†ºÁ¥ç„Åô„Çã*/
                       188 
000614 4EBA 0034       189 		jsr INQ
                       190 
000618 0C40 0000       191 		cmp.w #0x00,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
00061c 6700 0008       192 		beq PUTSTRING_MASK
                       193 		/*rv : Â§±Êïó„Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï„Åô„Çã*/
                       194 
000620 5284            195 		addq.l #0x01,%d4		/*sz++*/
000622 6000 FFE4       196 		bra LOOP_STEP5
                       197 
                       198 PUTSTRING_MASK:
000626 13FC 0037       199 		move.b #'7', LED1
       00D0 003B       199 
                       200 
00062e 33FC E10C       201 		move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       201 
000636 6000 0002       202 		bra PUTSTRING_END
                       203 
                       204 PUTSTRING_END:
00063a 2004            205 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
00063c 4CDF 7FF0       206 	movem.l (%SP)+, %a0-%a6/%d4-%d7
000640 13FC 0034       207 	move.b #'4', LED4
       00D0 0029       207 
                       208 	/*rte*/ 			/*?*/
                       209 	/* bus errorÂá∫„Åü„ÅÆ„ÅßÂ§âÊõ¥„Åó„Åü*/
                       210 	***
                       211 
                       212 	***
000648 4E75            213 	rts
                       214 ***************************************************************************************************
                       215 
                       216 	
                       217 **********INQ**********************************************************************
                       218 *d0 :„Ç≠„É•„ÉºÁï™Âè∑
                       219 *d1 :8bit„Éá„Éº„Çø
                       220 	*Âá∫ÂäõÔºöd0(Â§±Êïó 0/ ÊàêÂäü 1 )
                       221 /*
                       222 INQ:	
                       223 	move.w %sr, -(%sp)
                       224 	movem.l %d2-%d7/%a0-%a6,-(%sp) 
                       225 	move.w #0x2700,%sr
                       226 	lea.l	Q_INFO, %a1		/* a1: Q_INFO„ÅÆÈñãÂßãÂú∞ÁÇπ 
                       227 	lea.l	Q0_START, %a2 		/* a2: Q0„ÅÆÂÖàÈ†≠Áï™Âú∞ 
                       228 	move.w	#B_SIZE, %d2		/* d2: 256 
                       229 	move.w	#Q_INFO_SIZE, %d3	/* d3: 20 („Ç≠„É•„ÉºÔºëÂÄãÂàÜ„ÅÆÊÉÖÂ†±Èáè) 
                       230 	
                       231 	move.l	%d0,	%d4
                       232 	mulu	%d3,	%d4		/* d4 = d0 * Q_INFO_SIZE 
                       233 	move.l	%d4,	%a0
                       234 	add.l	%a1,	%a0		/* a0 = Q_INFO + d0 * Q_INFO_SIZE(ÂêÑ„Ç≠„É•„ÉºÊÉÖÂ†±„ÅÆÂÖàÈ†≠) 
                       235 	
                       236 	move.l	%d0,	%d4			
                       237 	mulu	%d2,	%d4		/* d4 = d0 * B_SIZE 
                       238 	move.l	%d4,	%a3
                       239 	add.l	%a2,	%a3		/* a3 = Q0_START + d0 * B_SIZE(ÂêÑ„Ç≠„É•„Éº„ÅÆÂÖàÈ†≠) 
                       240 	******************************************************************************************
                       241 	move.l	S_OFS(%a0), %d4
                       242 	cmpi.l	#256, %d4
                       243 	beq	INQ_Failure
                       244 	bra	INQ_Step1*/
                       245 INQ:
00064a 48E7 1000       246 	movem.l %d3, -(%sp)
00064e 40C3            247 	move.w %SR, %d3
000650 46FC 2700       248 	move.w #0x2700, %SR
000654 4EBA 0052       249 	jsr SELECT_QUEUE
000658 4EBA 00E0       250 	jsr PUT_BUF
00065c 46C3            251 	move.w %d3, %SR
00065e 4CDF 0008       252 	movem.l (%sp)+, %d3
000662 4E75            253 	rts
                       254 INQ_Failure:
000664 7000            255 	moveq	#0, %d0
000666 6000 0038       256 	bra	END_INQ
                       257 INQ_Step1:
                       258 	/* (4) */
00066a 2868 0008       259 	move.l	IN_OFS(%a0), %a4
00066e 1881            260 	move.b	%d1, (%a4)
                       261 
                       262 	/* (5) */
000670 2868 0008       263 	movea.l	IN_OFS(%a0), %a4
000674 2A68 000C       264 	movea.l	BOTTOM_OFS(%a0), %a5
000678 BBCC            265 	cmpa.l	%a4, %a5
00067a 6700 0010       266 	beq	BACK_IN
00067e 2868 0008       267 	movea.l	IN_OFS(%a0), %a4
000682 524C            268 	addq	#1, %a4
000684 214C 0008       269 	move.l	%a4, IN_OFS(%a0)
000688 6000 000A       270 	bra	INQ_Step2
                       271 BACK_IN:
00068c 2868 0000       272 	movea.l	TOP_OFS(%a0), %a4
000690 214C 0008       273 	move.l	%a4, IN_OFS(%a0)
                       274 INQ_Step2:
                       275 	/* (6) */
000694 2828 0010       276 	move.l	S_OFS(%a0), %d4
000698 5284            277 	addq.l	#1, %d4
00069a 2144 0010       278 	move.l	%d4, S_OFS(%a0)
00069e 7001            279 	moveq	#1, %d0
                       280 	
                       281 END_INQ:	
                       282 	/* (7) */
0006a0 4CDF 7FFC       283 	movem.l (%sp)+, %d2-%d7/%a0-%a6
0006a4 46DF            284 	move.w (%sp)+, %sr
0006a6 4E75            285 	rts
                       286 SELECT_QUEUE:
0006a8 0C00 0000       287 	cmp.b #0, %d0
0006ac 6700 000C       288 	beq SET_0
0006b0 0C00 0001       289 	cmp.b #1, %d0
0006b4 6700 0042       290 	beq SET_1
0006b8 4E75            291 	rts
                       292 
                       293 SET_0:
0006ba 48E7 0030       294 	movem.l %a2-%a3, -(%sp)
0006be 23F9 0000       295 	move.l in_0, in
       0000 0000       295 
       0000            295 
0006c8 23F9 0000       296 	move.l out_0, out
       0000 0000       296 
       0000            296 
0006d2 45F9 0000       297 	lea.l top, %a2
       0000            297 
0006d8 23CA 0000       298 	move.l %a2, START_LABEL
       0000            298 
0006de 47EA 00FF       299 	lea.l END_0(%a2), %a3
0006e2 23CB 0000       300 	move.l %a3, bottom
       0000            300 
0006e8 23F9 0000       301 	move.l s0,s
       0000 0000       301 
       0000            301 
0006f2 4CDF 0C00       302 	movem.l (%sp)+, %a2-%a3
0006f6 4E75            303 	rts
                       304 
                       305 SET_1:
0006f8 48E7 0030       306 	movem.l %a2-%a3, -(%sp)
0006fc 23F9 0000       307 	move.l in_1, in
       0000 0000       307 
       0000            307 
000706 23F9 0000       308 	move.l out_1, out
       0000 0000       308 
       0000            308 
000710 45F9 0000       309 	lea.l top, %a2
       0000            309 
000716 47EA 0100       310 	lea.l OFFSET_1(%a2), %a3
00071a 23CB 0000       311 	move.l %a3, START_LABEL
       0000            311 
000720 47EA 01FF       312 	lea.l END_1(%a2), %a3
000724 23CB 0000       313 	move.l %a3, bottom
       0000            313 
00072a 23F9 0000       314 	move.l s1,s
       0000 0000       314 
       0000            314 
000734 4CDF 0C00       315 	movem.l (%sp)+, %a2-%a3
000738 4E75            316 	rts
                       317 PUT_BUF:
00073a 48E7 407E       318 	movem.l %a1-%a6/%d1, -(%sp)
00073e 2439 0000       319 	move.l s,%d2
       0000            319 
000744 0C82 0000       320 	cmp.l #0x100,%d2
       0100            320 
00074a 6700 0042       321 	beq PUT_FAIL
00074e 49F9 0000       322 	lea.l s,%a4
       0000            322 
000754 5294            323 	addq.l #1,(%a4)
000756 143C 0001       324 	move.b #1,%d2 /*ÊàêÂäü*/
00075a 2279 0000       325 	movea.l in, %a1
       0000            325 
000760 12C1            326 	move.b %d1, (%a1)+
000762 2679 0000       327 	move.l bottom, %a3
       0000            327 
000768 B3CB            328 	cmpa.l %a3, %a1
00076a 6300 000A       329 	bls PUT_BUF_STEP1
00076e 2479 0000       330 	move.l START_LABEL, %a2
       0000            330 
000774 224A            331 	movea.l %a2, %a1
                       332 
                       333 PUT_BUF_STEP1:
000776 23C9 0000       334 	move.l %a1, in
       0000            334 
00077c B3F9 0000       335 	cmpa.l out, %a1
       0000            335 
000782 6600 0002       336 	bne PUT_BUF_STEP2
                       337 
                       338 PUT_BUF_STEP2:
000786 4EBA 0014       339 	jsr UPDATE
00078a 6000 000A       340 	bra PUT_BUF_Finish
                       341 
                       342 PUT_FAIL:
00078e 343C 0000       343 	move.w #0,%d2 /*Â§±Êïó*/
000792 4EBA 0008       344 	jsr UPDATE
                       345 
                       346 PUT_BUF_Finish:
000796 4CDF 7E02       347 	movem.l (%sp)+, %a1-%a6/%d1
00079a 4E75            348 	rts
                       349 
                       350 UPDATE:
00079c 0C00 0000       351 	cmp.b #0, %d0
0007a0 6700 000C       352 	beq QUEUE_0
0007a4 0C00 0001       353 	cmp.b #1, %d0
0007a8 6700 0022       354 	beq QUEUE_1
0007ac 4E75            355 	rts
                       356 
                       357 QUEUE_0:
0007ae 23C9 0000       358 	move.l %a1, in_0
       0000            358 
0007b4 23F9 0000       359 	move.l out, out_0
       0000 0000       359 
       0000            359 
0007be 23F9 0000       360 	move.l s,s0
       0000 0000       360 
       0000            360 
0007c8 3002            361 	move.w %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
0007ca 4E75            362 	rts
                       363 QUEUE_1:
0007cc 23C9 0000       364 	move.l %a1, in_1
       0000            364 
0007d2 23F9 0000       365 	move.l out, out_1
       0000 0000       365 
       0000            365 
0007dc 23F9 0000       366 	move.l s,s1
       0000 0000       366 
       0000            366 
0007e6 3002            367 	move.w %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
0007e8 4E75            368 	rts
                       369 ***********************************************************************************
                       370 
                       371 
                       372 **********OUTQ**********************************************************************
                       373 *d0 :„Ç≠„É•„ÉºÁï™Âè∑
                       374 *Âá∫ÂäõÔºëÔºöd0(Â§±Êïó 0/ ÊàêÂäü 1 )
                       375 *Âá∫ÂäõÔºíÔºöd1ÔºàÂèñ„ÇäÂá∫„Åó„Åü8bit„Éá„Éº„ÇøÔºâ
                       376 /*
                       377 OUTQ:
                       378 	move.w %sr, -(%sp)
                       379 	movem.l %d2-%d7/%a0-%a6,-(%sp) 
                       380 	move.w #0x2700,%sr
                       381 	*/
                       382 OUTQ:
                       383 	*move.w #0x0800+'a', UTX1
0007ea 48E7 1000       384 	movem.l %d3, -(%sp)
0007ee 40C3            385 	move.w %SR, %d3
0007f0 46FC 2700       386 	move.w #0x2700, %SR
0007f4 4EBA FEB2       387 	jsr SELECT_QUEUE
0007f8 4EBA 004E       388 	jsr GET_BUF
0007fc 46C3            389 	move.w %d3, %SR
0007fe 4CDF 0008       390 	movem.l (%sp)+, %d3
000802 4E75            391 	rts
                       392 ******************************************************************************************
                       393 ******************************************************************************************
                       394 OUTQ_Failure:
000804 7000            395 	moveq	#0, %d0
000806 6000 0038       396 	bra	END_OUTQ
                       397 OUTQ_Step1:
                       398 	/* (4) */
00080a 2868 0004       399 	move.l	OUT_OFS(%a0), %a4
00080e 1214            400 	move.b	(%a4), %d1
                       401 
                       402 	/* (5) */
000810 2868 0004       403 	movea.l	OUT_OFS(%a0), %a4
000814 2A68 000C       404 	movea.l	BOTTOM_OFS(%a0), %a5
000818 BBCC            405 	cmpa.l	%a4, %a5
00081a 6700 0010       406 	beq	BACK_OUT
00081e 2868 0004       407 	movea.l	OUT_OFS(%a0), %a4
000822 524C            408 	addq	#1, %a4
000824 214C 0004       409 	move.l	%a4, OUT_OFS(%a0)
000828 6000 000A       410 	bra	OUTQ_Step2
                       411 BACK_OUT:
00082c 2868 0000       412 	movea.l	TOP_OFS(%a0), %a4
000830 214C 0004       413 	move.l	%a4, OUT_OFS(%a0)
                       414 OUTQ_Step2:
                       415 	/* (6) */
000834 2828 0010       416 	move.l	S_OFS(%a0), %d4
000838 5384            417 	subq.l	#1, %d4
00083a 2144 0010       418 	move.l	%d4, S_OFS(%a0)
00083e 7001            419 	moveq	#1, %d0
                       420 	
                       421 END_OUTQ:	
                       422 	/* (7) */
000840 4CDF 7FFC       423 	movem.l (%sp)+, %d2-%d7/%a0-%a6
000844 46DF            424 	move.w (%sp)+, %sr
000846 4E75            425 	rts
                       426 GET_BUF:
000848 48E7 007E       427 	movem.l %a1-%a6, -(%sp)
00084c 2439 0000       428 	move.l s,%d2
       0000            428 
000852 0C82 0000       429 	cmp.l #0x00,%d2
       0000            429 
000858 6700 0042       430 	beq GET_FAIL
                       431 	
00085c 143C 0001       432 	move.b #1,%d2 /*ÊàêÂäü*/
000860 49F9 0000       433 	lea.l s,%a4
       0000            433 
000866 5394            434 	subq.l #1,(%a4)
000868 2279 0000       435 	movea.l out, %a1
       0000            435 
00086e 1219            436 	move.b (%a1)+, %d1
000870 2679 0000       437 	move.l bottom, %a3
       0000            437 
000876 B3CB            438 	cmpa.l %a3, %a1
000878 6300 000A       439 	bls GET_BUF_STEP1
00087c 2479 0000       440 	move.l START_LABEL, %a2
       0000            440 
000882 224A            441 	movea.l %a2, %a1
                       442 
                       443 GET_BUF_STEP1:
000884 23C9 0000       444 	move.l %a1, out
       0000            444 
00088a B3F9 0000       445 	cmpa.l in, %a1
       0000            445 
000890 6600 0002       446 	bne GET_BUF_STEP2
                       447 
                       448 GET_BUF_STEP2:
000894 4EBA FF06       449 	jsr UPDATE
000898 6000 000A       450 	bra GET_BUF_Finish
                       451 
                       452 GET_FAIL:
00089c 343C 0000       453 	move.w #0,%d2 /*Â§±Êïó*/
0008a0 4EBA FEFA       454 	jsr UPDATE
                       455 *move.w #0x0800+'e', UTX1
                       456 
                       457 GET_BUF_Finish:
0008a4 4CDF 7E00       458 	movem.l (%sp)+, %a1-%a6
0008a8 4E75            459 	rts
                       460 
                       461 	
                       462 .section .data
                       463 ******************************
                       464 ** „Ç≠„É•„ÉºÁî®„ÅÆ„É°„É¢„É™È†òÂüüÁ¢∫‰øù„Å®ÂÆöÊï∞ÂÆöÁæ©
                       465 ******************************
                       466 .equ	B_SIZE, 	256
                       467 .equ	B_SIZE_MINUS,	255
                       468 .equ	Q_NUM,		2
                       469 .equ	TOP_OFS,	0
                       470 .equ	OUT_OFS,	4
                       471 .equ	IN_OFS,		8
                       472 .equ	BOTTOM_OFS,	12
                       473 .equ	S_OFS,		16
                       474 .equ	Q_INFO_SIZE,	20
                       475 .even
000bb8 0000 0000       476 Q0_START: 	.ds.b	B_SIZE
       0000 0000       476 
       0000 0000       476 
       0000 0000       476 
       0000 0000       476 
000cb8 0000 0000       477 Q1_START: 	.ds.b	B_SIZE
       0000 0000       477 
       0000 0000       477 
       0000 0000       477 
       0000 0000       477 
                       478 .even
                       479 Q_INFO:
000db8 0000 0000       480 	.ds.b	Q_INFO_SIZE * Q_NUM	
       0000 0000       480 
       0000 0000       480 
       0000 0000       480 
       0000 0000       480 
                       481 ******************************
                       482 ** Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„ÇøÔºà„Çµ„É≥„Éó„É´Ôºâ
                       483 ******************************
000de0 6162 6364       484 Data_to_Que: 	.ascii	"abcdef"		/* Ë™≠„ÅøÊõ∏„Åç„ÉÜ„Çπ„ÉàÁî®„Å´1„Éê„Ç§„ÉàÁ¢∫‰øù */
       6566            484 
                       485 
000de6 0000 0000       486 INQ_Result: .ds.l   300
       0000 0000       486 
       0000 0000       486 
       0000 0000       486 
       0000 0000       486 
001296 0000 0000       487 OUTQ_Data:  .ds.b   300
       0000 0000       487 
       0000 0000       487 
       0000 0000       487 
       0000 0000       487 
0013c2 0000 0000       488 OUTQ_Result:.ds.l   300
       0000 0000       488 
       0000 0000       488 
       0000 0000       488 
       0000 0000       488 
                       140 .include "interget.s"
                        -4 .section .text
                        -3 
                        -2 ***************************
                        -1 ** %d1.l = ch
                         0 ** %d2.b = Âèó‰ø°„Éá„Éº„Çø  data
                         1 ** Êàª„ÇäÂÄ§  „Å™„Åó
                         2 ***************************
                         3 INTERGET:
0008aa 0C81 0000         4 	cmpi.l #0, %d1    /* ch != 0 „Å™„ÇâÁµÇ‰∫Ü */                    
       0000              4 
0008b0 6600 000A         5 	bne INTERGET_END 
0008b4 1202              6 	move.b %d2, %d1   /* %d1 = data */
0008b6 7000              7 	moveq.l #0, %d0   /* „Ç≠„É•„ÉºÁï™Âè∑„Çí 0 „Å´Ë®≠ÂÆö */          
0008b8 4EBA FD90         8 	jsr INQ           /* INQ(0, data) */
                         9 
                        10 INTERGET_END:
0008bc 4E75             11 	rts
                        12 	
                        13 **********************************************
                        14 ** %d1.l = ch
                        15 ** %d2.l = Êõ∏„ÅçËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ p
                        16 ** %d3.l = Âèñ„ÇäÂá∫„Åô„Éá„Éº„ÇøÊï∞  size
                        17 ** Êàª„ÇäÂÄ§  %d0.l = ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞  sz 
                        18 **********************************************
                        19 GETSTRING:
0008be 48E7 0880        20 	movem.l %d4/%a0, -(%sp)
0008c2 0C81 0000        21 	cmp.l #0, %d1            /* ch != 0 „Å™„ÇâÁµÇ‰∫Ü */                  
       0000             21 
0008c8 6600 0026        22 	bne GETSTRING_END      
0008cc 7800             23 	moveq.l #0, %d4          /* %d4 = 0 , %d4„ÅØ%d0(=sz)„ÅÆ‰∏ÄÊôÇ‰øùÂ≠ò„É¨„Ç∏„Çπ„Çø */                
0008ce 2042             24 	movea.l %d2, %a0         /* %a0 = p */       
                        25 
                        26 GETSTRING_STEP1:
0008d0 B684             27 	cmp.l %d4, %d3           /* %d4 = size „Å™„Çâ STEP2 „Å∏ */               
0008d2 6700 001A        28 	beq GETSTRING_STEP2
0008d6 7000             29 	moveq.l #0, %d0          /* %d0 = 0, „Ç≠„É•„ÉºÁï™Âè∑„Çí0„Å´ */
0008d8 4EBA FF10        30 	jsr OUTQ                 /* OUTQ(0,data) */      
0008dc 0C80 0000        31 	cmpi.l #0, %d0           /* Âæ©Â∏∞ÂÄ§ %d0 „Åå 0 „Å™„Çâ STEP2 „Å∏ */           
       0000             31 
0008e2 6700 000A        32 	beq GETSTRING_STEP2      
0008e6 10C1             33 	move.b %d1, (%a0)+       /* %a0 Áï™Âú∞„Å∏ data „Çí„Ç≥„Éî„Éº, %a0++ */                             
0008e8 5284             34 	addq.l #1, %d4           /* %d4++ */      
0008ea 6000 FFE4        35 	bra GETSTRING_STEP1      
                        36 
                        37 GETSTRING_STEP2:
0008ee 2004             38 	move.l %d4, %d0          /* %d0 = %d4 */  
                        39 
                        40 GETSTRING_END:
0008f0 4CDF 0110        41 	movem.l (%sp)+, %d4/%a0
0008f4 4E75             42 	rts
                       141 .include "timer.s"
                        -4 .section .bss
005894 0000 0000        -3 task_p:	.ds.b 4 /*„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„ÅßÂÆüË°å„Åô„Çã„Éó„É≠„Ç∞„É©„É†„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„ÇíÊ†ºÁ¥ç
                        -2 
                        -1 .section .text
                         0 /*„Çø„Ç§„Éû„É´„Éº„ÉÅ„É≥*/
                         1 RESET_TIMER:
0008f6 33FC 0004         2 	move.w #0x0004, TCTL1
       00FF F600         2 
0008fe 4E75              3 	rts
                         4 
                         5 SET_TIMER:
000900 23C2 0000         6 	move.l %D2, task_p
       0000              6 
000906 33FC 00CE         7 	move.w #206, TPRER1 /*„Ç´„Ç¶„É≥„ÇøÂë®Ê≥¢Êï∞„Çí10000„Å´„Åô„Çã-> Âë®Êúü0.1msec*/
       00FF F602         7 
00090e 33C1 00FF         8 	move.w %D1, TCMP1
       F604              8 
000914 33FC 0015         9 	move.w #0x0015, TCTL1 /*ÊØîËºÉÂâ≤„ÇäËæº„ÅøË®±ÂèØ, 1/16Âë®Êúü, „Çø„Ç§„ÉûË®±ÂèØ*/
       00FF F600         9 
00091c 4E75             10 	rts
                        11 
                        12 CALL_RP:
00091e 2079 0000        13 	movea.l task_p, %A0
       0000             13 
000924 4E90             14 	jsr  (%A0)
000926 4E75             15 	rts
                       142 .include "typeren2.s"
                        -4 ***************************************************************
                        -3 **ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                        -2 ***************************************************************
                        -1 ***************
                         0 ** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                         1 ***************
                         2 .equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                         3 .equ IOBASE,    0x00d00000
                         4 ***************
                         5 ** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                         6 ***************
                         7 .equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                         8 .equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                         9 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        10 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        11 
                        12 ***************
                        13 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        14 ***************
                        15 .equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        16 .equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        17 .equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        18 .equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        19 .equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        20 ***************
                        21 ** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        22 ***************
                        23 .equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        24 .equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        25 .equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        26 .equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        27 
                        28 ***************
                        29 ** LED
                        30 ***************
                        31 .equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        32 .equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        33 .equ LED5,      IOBASE+0x000002b
                        34 .equ LED4,      IOBASE+0x0000029
                        35 .equ LED3,      IOBASE+0x000003f
                        36 .equ LED2,      IOBASE+0x000003d
                        37 .equ LED1,      IOBASE+0x000003b
                        38 .equ LED0,      IOBASE+0x0000039
                        39 ***************************************************************
                        40 * „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        41 ***************************************************************
                        42 ***************************************************************
                        43 ** ÂàùÊúüÂåñ
                        44 ** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        45 ** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        46 ***************************************************************
                        47 .section .data
001872 3031 3233        48 	TDATA1: .ascii "0123456789ABCDEF"
       3435 3637        48 
       3839 4142        48 
       4344 4546        48 
001882 6B6C 6D6E        49 	TDATA2: .ascii "klmnopqrstuvwxyz"
       6F70 7172        49 
       7374 7576        49 
       7778 797A        49 
                        50 ***************************************************************
                        51 ** ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´‚Äôa‚Äô„Çí
                        52 ** ÈÄÅ‰ø°„É¨„Ç∏„Çπ„ÇøUTX1„Å´Êõ∏„ÅçËæº„ÇÄÔºé'a'„ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                        53 ***************************************************************
                        54 .section .text
                        55 .even
                        56 MAIN:
000928 4EBA FBF8        57 		jsr Init_Q
00092c 13FC 0031        58 		move.b #'1', LED7
       00D0 002F        58 
000934 33FC E108        59 		move.w #0xe108,USTCNT1/**/
       00FF F900        59 
00093c 46FC 2000        60 		move.w #0x2000, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´0 */
                        61 PS_TEST1:
                        62 		/* jsr PUTSTRING(0, #TDATA1, 16)*/
000940 123C 0000        63 		move.b	#0x00, %d1
000944 243C 0000        64 		move.l	#TDATA1, %d2
       0000             64 
00094a 7610             65 		move.l	#0x10, %d3
00094c 4EBA FCA0        66 		jsr PUTSTRING
                        67 		
                        68 	
000950 13FC 0032        69 		move.b #'2', LED6
       00D0 002D        69 
000958 283C 000F        70 		move.l	#0x0fffff, %d4
       FFFF             70 
                        71 	
                        72 		
                        73 LOOP:
00095e 5384             74 		subq.l #1,%d4
000960 6700 000E        75 		beq PS_TEST2
000964 13FC 0035        76 		move.b #'5', LED3
       00D0 003F        76 
                        77 		
00096c 6000 FFF0        78 		bra LOOP
                        79 
                        80 PS_TEST2:
000970 13FC 0036        81 	move.b #'6', LED2
       00D0 003D        81 
000978 123C 0000        82 	move.b	#0x00, %d1
00097c 243C 0000        83 	move.l	#TDATA2, %d2
       0000             83 
000982 7610             84 	move.l	#0x10, %d3
000984 4EBA FC68        85 	jsr PUTSTRING
000988 4E75             86 	rts
                        87 /*bra PS_TEST2*/
                        88 /*‰ª•‰∏ã„ÉÜ„Çπ„Éà*/
                        89 /*TEST_READY:
                        90 		*movem.l %d1-%d5, -(%sp)
                        91 		move.w #16, %d4
                        92 		move.w #16, %d5
                        93 		move.b #0x61, %d1
                        94 		bra TEST_LOOP
                        95 
                        96 TEST_LOOP2:
                        97 
                        98 		addq #1, %d1
                        99 		move.w #16, %d4
                       100 
                       101 TEST_LOOP:
                       102 		moveq #1, %d0
                       103 		*move.w #0x1000, %d0
                       104 		jsr INQ
                       105 		*jsr OUTQ
                       106 		subq #1, %d4
                       107 		bne TEST_LOOP
                       108 		subq #1, %d5
                       109 		beq TEST_END
                       110 		bra TEST_LOOP2
                       111 
                       112 TEST_END:
                       113 	*movem.l (%sp)+, %d1-%d5
                       114 	rts
                       115 	*/
                       116 /*‰ª•‰∏ä„ÉÜ„Çπ„Éà*/
                       143 .end
